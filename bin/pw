#!/usr/bin/env ruby

require 'pushwagner'

def get_version
  Pushwagner.info "You must specify which version you wish to deploy"
  STDIN.gets.strip
end

# TODO: detect version requirement from config
version = 1 # ENV["VERSION"] || get_version

env = ARGV[1] || ENV['PW_ENV'] || 'default'

main = Pushwagner::Main.new(:config_file => 'config/deploy.yml', :version => version, :environment => env)

puts %q{
                 _
 _ __  _   _ ___| |____      ____ _  __ _ _ __   ___ _ __
| '_ \| | | / __| '_ \ \ /\ / / _` |/ _` | '_ \ / _ \ '__|
| |_) | |_| \__ \ | | \ V  V / (_| | (_| | | | |  __/ | _
| .__/ \__,_|___/_| |_|\_/\_/ \__,_|\__, |_| |_|\___|_|(oc)
|_|                                 |___/

}.colorize(color: :blue, mode: :bold)

# TODO: detect cli from config
case ARGV[0]
  when "deploy"
    main.deploy
  else
    Pushwagner.warning "Usage: pw <deploy|todo> [environment]"
end
